<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Contact TMH</title>
    <link rel="stylesheet" href="./styles/site.css" />
  </head>
  <body class="page page--contact">
    <modular-menu
      data-links='[
        {"label":"Home","href":"./index.html"},
        {"label":"About Us","href":"./aboutus.html"}
        {"label":"Resources","href":./resources.html"},,
        {"label":"Contact","href":"./contact.html"},
        {"label":"Community Engagement","href":"./community.html"},
        {"label":"Donate","href":"./donate.html"},
        {"label":"Merch Store","href":"./shop.html"}
      ]'
    ></modular-menu>

    <main>
      <h1 class="text-center">Contact the TMH Staff</h1>
      <p class="text-center">
        PLACEHOLDER
      </p>

      <form id="contactForm">
        <div>
          <label for="name">Name / Handle</label>
          <input id="name" name="name" type="text" required placeholder="Call sign, nickname, or first name" />
        </div>
        <div>
          <label for="contactInfo">Preferred Contact</label>
          <input id="contactInfo" name="contactInfo" type="text" required placeholder="@discordname, email, etc." />
        </div>
        <div>
          <label for="message">Message</label>
          <textarea id="message" name="message" required placeholder="Share as much context as you feel comfortable."></textarea>
        </div>
        <button type="submit">Send to Staff</button>
        <p class="status" id="statusText"></p>
      </form>
    </main>

    <script src="./scripts/menu-component.js"></script>
    <script>
      const DISCORD_WEBHOOK_URL = "https://website.rennygadewarrior.workers.dev";

      const form = document.getElementById('contactForm');
      const statusText = document.getElementById('statusText');

      form.addEventListener('submit', async event => {
        event.preventDefault();
        statusText.textContent = 'Sending...';
        statusText.className = 'status';

        const payload = {
          name: form.name.value,
          contactInfo: form.contactInfo.value,
          message: form.message.value
        };


        try {
          const response = await fetch(DISCORD_WEBHOOK_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });

          if (!response.ok) {
            throw new Error('Request failed');
          }

          statusText.textContent = 'Message delivered to staff. We will respond soon.';
          statusText.classList.add('success');
          form.reset();
        } catch (error) {
          console.error(error);
          statusText.textContent =
            'Unable to reach the Discord bot. Please try again or ping staff directly.';
          statusText.classList.add('error');
        }
      });
    </script>
  </body>
</html>
